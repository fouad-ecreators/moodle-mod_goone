define ("mod_goone/browser",["jquery","core/templates","core/str","core/notification","core/ajax","core/modal_factory","core/modal_events"],function(a,b,c,d,e,f,g){var h={offSet:0,initial:0};c.get_string("expand","core",h.cleartext);h.init=function(){a(document).ready(function(){a("#sort").change(function(){h.changeFilter()});a("#provider").multiselect({inheritClass:!0,enableFiltering:!0,enableCaseInsensitiveFiltering:!0,maxHeight:350,buttonWidth:"15rem",includeResetOption:!0,resetText:h.cleartext,nonSelectedText:"Any",onChange:function onChange(){h.changeFilter()}});a("#tag").multiselect({inheritClass:!0,enableFiltering:!0,enableCaseInsensitiveFiltering:!0,maxHeight:350,buttonWidth:"15rem",includeResetOption:!0,resetText:h.cleartext,nonSelectedText:"Any",onChange:function onChange(){h.changeFilter()}});a("#language").multiselect({inheritClass:!0,enableFiltering:!0,enableCaseInsensitiveFiltering:!0,maxHeight:350,buttonWidth:"15rem",includeResetOption:!0,resetText:h.cleartext,nonSelectedText:"Any",onChange:function onChange(){h.changeFilter()}});a("#type").multiselect({inheritClass:!0,enableFiltering:!0,enableCaseInsensitiveFiltering:!0,maxHeight:350,buttonWidth:"15rem",includeResetOption:!0,resetText:h.cleartext,nonSelectedText:"Any",onChange:function onChange(){h.changeFilter()}});a(".multiselect-reset").on("click",function(){h.changeFilter()});h.loadResults(a("#type").val(),a("#tag").val(),a("#language").val(),a("#provider").val(),a("#keyword").val(),a("#sort").val(),h.offSet)});a(document).on("click","#lomodal",function(){var h=a(this).data("name"),i=a(this).data("id");return f.create({title:h,type:f.types.SAVE_CANCEL,large:!0}).done(function(a){e.call([{methodname:"mod_goone_get_modal",args:{loid:i},done:function done(c){a.setBody(b.render("mod_goone/modal",JSON.parse(c.result)))},fail:d.exception}]);a.setSaveButtonText(c.get_string("submit","core"));a.getRoot().on(g.save,function(){try{window.opener.$("#id_loid").val(i);window.opener.$("#id_loname").val(h)}catch(a){}window.close();return!1});a.show()})});a("#load-more").click(function(){h.offSet=h.offSet+20;h.loadResults(a("#type").val(),a("#tag").val(),a("#language").val(),a("#provider").val(),a("#keyword").val(),a("#sort").val(),h.offSet)});a("#keyword").keypress(function(b){if(13==b.which){a("#keyword").submit();h.changeFilter()}})};h.changeFilter=function(){if(0==h.initial){a("#sort").val("relevance");h.initial=1}h.offSet=0;a("#goone-browser-results").html("");h.loadResults(a("#type").val(),a("#tag").val(),a("#language").val(),a("#provider").val(),a("#keyword").val(),a("#sort").val(),h.offSet)};h.loadResults=function(b,c,f,g,i,j,k){a("#spinny").show();e.call([{methodname:"mod_goone_get_hits",args:{type:b,tag:c,language:f,provider:g,keyword:i,sort:j,offset:k},done:function done(d){a("#goone-browser-results").append(d.result);a("#spinny").hide();a("#latest-go1-result h2").html(a(".go1-result").last().html());var e=parseInt(a("#total-hits").text(),10);if(20>=e||k>=e-20){a("#load-more-div").hide();a("#end-of-results").show()}else{a("#load-more-div").show();a("#end-of-results").hide()}if(b+""!=a("#type").val()+""||c+""!=a("#tag").val()+""||f+""!=a("#language").val()+""||g+""!=a("#provider").val()+""){h.changeFilter()}},fail:d.exception}])};return h});
//# sourceMappingURL=browser.min.js.map
