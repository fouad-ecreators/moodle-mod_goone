{"version":3,"sources":["../src/browser.js"],"names":["define","$","Templates","Str","Notification","Ajax","ModalFactory","ModalEvents","browser","offSet","initial","get_string","cleartext","init","document","ready","change","changeFilter","multiselect","inheritClass","enableFiltering","enableCaseInsensitiveFiltering","maxHeight","buttonWidth","includeResetOption","resetText","nonSelectedText","onChange","on","loadResults","val","loname","data","loid","create","title","type","types","SAVE_CANCEL","large","done","modal","call","methodname","args","setBody","render","JSON","parse","result","fail","exception","setSaveButtonText","getRoot","save","window","opener","err","close","show","click","keypress","e","which","submit","html","tag","language","provider","keyword","sort","offset","append","hide","last","total","parseInt","text"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript for browser.php functions.\n *\n * @package   mod_goone\n * @copyright 2019, eCreators PTY LTD\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @author    Fouad Saikali <fouad@ecreators.com.au>\n */\n\ndefine(['jquery', 'core/templates', 'core/str', 'core/notification', 'core/ajax', 'core/modal_factory', 'core/modal_events'],\n    function($, Templates, Str, Notification, Ajax, ModalFactory, ModalEvents) {\n        var browser = {};\n\n        browser.offSet = 0;\n        browser.initial = 0;\n        Str.get_string('expand', 'core', browser.cleartext);\n        browser.init = function() {\n            $(document).ready(function () {\n                $('#sort').change(function() {\n                    browser.changeFilter();\n                });\n                $('#provider').multiselect({\n                    inheritClass: true,\n                    enableFiltering: true,\n                    enableCaseInsensitiveFiltering:true,\n                    maxHeight: 350,\n                    buttonWidth: '15rem',\n                    includeResetOption: true,\n                    resetText: browser.cleartext,\n                    nonSelectedText: \"Any\",\n                    onChange: function() {\n                        browser.changeFilter();\n                    }});\n                $('#tag').multiselect({inheritClass: true,\n                    enableFiltering: true,\n                    enableCaseInsensitiveFiltering:true,\n                    maxHeight: 350,\n                    buttonWidth: '15rem',\n                    includeResetOption: true,\n                    resetText: browser.cleartext,\n                    nonSelectedText: \"Any\",\n                    onChange: function() {\n                        browser.changeFilter();\n                    }});\n                $('#language').multiselect({inheritClass: true,\n                    enableFiltering: true,\n                    enableCaseInsensitiveFiltering:true,\n                    maxHeight: 350,\n                    buttonWidth: '15rem',\n                    includeResetOption: true,\n                    resetText: browser.cleartext,\n                    nonSelectedText: \"Any\",\n                    onChange: function() {\n                        browser.changeFilter();\n                    }});\n                $('#type').multiselect({inheritClass: true,\n                    enableFiltering: true,\n                    enableCaseInsensitiveFiltering:true,\n                    maxHeight: 350,\n                    buttonWidth: '15rem',\n                    includeResetOption: true,\n                    resetText: browser.cleartext,\n                    nonSelectedText: \"Any\",\n                    onChange: function() {\n                        browser.changeFilter();\n                    }});\n                $('.multiselect-reset').on('click',function () {\n                        browser.changeFilter();\n                });\n                browser.loadResults($(\"#type\").val(),$(\"#tag\").val(),$(\"#language\").val(),$(\"#provider\").val(),\n                    $(\"#keyword\").val(),$(\"#sort\").val(),browser.offSet);\n            });\n\n            $(document).on('click', '#lomodal', function() {\n                var loname = $(this).data('name');\n                var loid = $(this).data('id');\n\n                   return ModalFactory.create({\n                        title: loname,\n                        type: ModalFactory.types.SAVE_CANCEL,\n                        large: true\n                    }).done(function(modal) {\n                        Ajax.call([{\n                            methodname: 'mod_goone_get_modal',\n                            args: {loid: loid},\n                            done: function(data) {\n                                modal.setBody(Templates.render('mod_goone/modal', JSON.parse(data.result)));\n                            },\n                            fail: Notification.exception\n                        }]);\n                        modal.setSaveButtonText(Str.get_string('submit', 'core'));\n                        modal.getRoot().on(ModalEvents.save, function() {\n                            try {\n                                window.opener.$('#id_loid').val(loid);\n                                window.opener.$('#id_loname').val(loname);\n                            }\n                            catch (err) {}\n                            window.close();\n                            return false;\n                        });\n                        modal.show();\n                    });\n            });\n            $(\"#load-more\").click(function() {\n                browser.offSet = browser.offSet + 20;\n                browser.loadResults($(\"#type\").val(),$(\"#tag\").val(),$(\"#language\").val(),$(\"#provider\").val(),\n                    $(\"#keyword\").val(),$(\"#sort\").val(),browser.offSet);\n            });\n            $('#keyword').keypress(function (e) {\n                if (e.which == 13) {\n                    $('#keyword').submit();\n                    browser.changeFilter();\n                }\n            });\n        };\n\n        browser.changeFilter = function() {\n            if (browser.initial == 0) {\n                $(\"#sort\").val(\"relevance\");\n                browser.initial = 1;\n            }\n            browser.offSet = 0;\n            $(\"#goone-browser-results\").html(\"\");\n            browser.loadResults($(\"#type\").val(),$(\"#tag\").val(),$(\"#language\").val(),$(\"#provider\").val(),\n                $(\"#keyword\").val(),$(\"#sort\").val(),browser.offSet);\n        };\n\n        browser.loadResults = function(type, tag, language, provider, keyword, sort, offSet) {\n\n            $(\"#spinny\").show();\n            Ajax.call([{\n                methodname: 'mod_goone_get_hits',\n                args: {type: type, tag: tag, language: language, provider: provider, keyword: keyword, sort: sort, offset: offSet},\n                done: function(data) {\n                    $(\"#goone-browser-results\").append(data.result);\n                    $(\"#spinny\").hide();\n                    $(\"#latest-go1-result h2\").html($(\".go1-result\").last().html());\n                    var total = parseInt($(\"#total-hits\").text(), 10);\n\n                    if (total <= 20 || offSet >= total - 20) {\n                        $(\"#load-more-div\").hide();\n                        $(\"#end-of-results\").show();\n                    } else {\n                        $(\"#load-more-div\").show();\n                        $(\"#end-of-results\").hide();\n                    }\n                    if(type + '' != $(\"#type\").val() + '' || tag + '' != $(\"#tag\").val() + '' || language + '' != $(\"#language\").val() + ''\n                        || provider + '' != $(\"#provider\").val() + '') {\n                            browser.changeFilter();\n                    }\n                },\n                fail: Notification.exception\n            }]);\n        };\n\n        return browser;\n    });\n"],"file":"browser.min.js"}