


<!-- modal -->
<div class="modal fade" id="lomodal" tabindex="-1" role="dialog" aria-labelledby="lomodalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg ">
    <div class="modal-content " style="height:900px;width:900px;" >
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
      </div>
      <div class="modal-body embed-responsive">
          <iframe class="embed-responsive-item" id="loiframe" src="https://cdn-images-1.medium.com/max/1600/1*9EBHIOzhE1XfMYoKz1JcsQ.gif" frameborder="0" allowtransparency="true"></iframe>  
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" id="submitlo" loid="#" loname="#" onclick="return CloseMySelf(this);">Select</button>
      </div>
    </div>
  </div>
</div>




<div class="container" >
                    <h2>Filters</h2>

    <form class="form-inline">





        <div class="form-row w-100 mb-2">

            <div class="form-group col-sm-10 col-lg-10">
                <div>
                <label for="keyword" class="control-label ml-0">Keyword search
                </label>
            </div>
                <input type="text"  class="form-control w-100" name="keyword" id="keyword"/>
            </div>



            <div class="form-group col-sm-2 col-lg-2 float-right">
                <div><label class="control-label ml-0" for="sort">
                    Sort
                </label>
            </div>
            <select class="custom-select w-100" id="sort" name="sort">
                    <option value="relevance">Relevance</option><option value="popularity" {{msort}}>Popularity</option><option value="price">Price</option><option value="title">Title</option><option value="created">Created</option>
                </select>
            </div>
        </div>





        <div class="form-row">

            <div class="form-group col-sm-6 col-md-3">
                <label for="provider" class="control-label ml-0">
                Providers
            </label>
            {{#facets}}{{#instance}}
            <div>
            <select name="provider" id="provider" multiple="multiple">
                
                    {{#buckets}}

                    <option value="{{ key }}">{{ name }}</option>

                    {{/buckets}}

                    
                </select>
            </div>
            {{/instance}}{{/facets}}
            </div>
            <div class="form-group col-sm-6 col-md-3">
                <label class="control-label ml-0" for="language">
                {{#facets}}{{#language}}Language
            </label>
            <div>
            <select name="language" id="language" multiple="multiple">
                    {{#buckets}}<option value="{{ key }}" {{selected}}>{{ name }}</option>{{/buckets}}
                    {{/language}}{{/facets}}
                </select>
            </div>
            </div>
            <div class="form-group col-sm-6 col-md-3">
                <label class="control-label ml-0" for="tag">
                {{#facets}}{{#tag}}Tag
            </label>
            <div>
            <select name="tag" id="tag" multiple="multiple">
                    {{#buckets}}<option value="{{ key }}">{{ key }}</option>{{/buckets}}
                    {{/tag}}{{/facets}}
                </select>
            </div>
            </div>
            <div class="form-group col-sm-6 col-md-3">
                <label class="control-label ml-0" for="type">
                    Type
                </label>
                <div>
                    <select name="type" id="type" class="form-control multiselect-search" multiple="multiple">
                    <option value="activities">activities</option><option value="assignment">assignment</option><option value="attendance">attendance</option><option value="award">award</option><option value="course">course</option><option value="document">document</option><option value="event">event</option><option value="h5p">h5p</option><option value="iframe">iframe</option><option value="integration">integration</option><option value="interactive">interactive</option><option value="learning_pathway">learning_pathway</option><option value="learning_resource">learning_resource</option><option value="lti">lti</option><option value="question">question</option><option value="quiz">quiz</option><option value="resource">resource</option><option value="text">text</option><option value="video">video</option><option value="workshop">workshop</option>
                </select>
            </div>
            </div>
        </div>

            </form>

</div>
    <script type="text/javascript">
    $(document).ready(function() {
        $('#sort').change(function() {
                changeFilter();
            });

        $('#provider').multiselect({
            inheritClass: true,
             enableFiltering: true,
              maxHeight: 350,
               buttonWidth: '250px',
               includeResetOption: true,
            resetText: "Clear Selection",
            nonSelectedText: "Any",
            onChange: function() {
                changeFilter();
            }});
        $('#tag').multiselect({inheritClass: true, enableFiltering: true, maxHeight: 350, buttonWidth: '250px',
            includeResetOption: true,
            resetText: "Clear Selection",
            nonSelectedText: "Any",
            onChange: function(element, checked) {
                changeFilter();
            }});
        $('#language').multiselect({inheritClass: true, enableFiltering: true, maxHeight: 350, buttonWidth: '250px',
                           includeResetOption: true,
            resetText: "Clear Selection",
            nonSelectedText: "Any",
            onChange: function(element, checked) {
                changeFilter();
            }});
        $('#type').multiselect({inheritClass: true, enableFiltering: true, maxHeight: 350, buttonWidth: '250px',
                           includeResetOption: true,
            resetText: "Clear Selection",
            nonSelectedText: "Any",
            onChange: function(element, checked) {
                changeFilter();
            }});

    $('.multiselect-reset')
    .on(
        'click',
        function () {
        changeFilter();      
        }
    );


    });

</script>




<style>
    .form-inline label {
        display:block;


    }
    .multiselect-clear-filter{
        display: none;
    }
</style>


<div class="container">
        <div id="latest-go1-result">
            <h2>Results:</h2>
        </div>
        <div id="goone-browser-results">
    
            
        </div>

        <div id="spinny" class="w-100 text-center" style="display:block;">
            <img src="https://cdn-images-1.medium.com/max/1600/1*9EBHIOzhE1XfMYoKz1JcsQ.gif">
        </div>
                <div id="load-more-div" class="w-100 text-center my-2" style="display:none;">
        <button id="load-more" class="btn btn-primary margin-top-5"> Load More</button>
        </div>
                        <div id="end-of-results" class="w-100 text-center my-2" style="display:none;">
        End of results.
        </div>



        <script>

var offSet = 0;
var totalHits = 0;

function changeFilter() {
    offSet = 0;
    $("#goone-browser-results").html("");
    loadResults($("#type").val(),$("#tag").val(),$("#language").val(),$("#provider").val(),$("#keyword").val(),$("#sort").val(),offSet);
}

function loadResults(ptype, tag, language, provider, keyword, sort, offSet){
    url = "/mod/goone/hits.php?"
     + "type=" + ptype
     + "&tag=" + tag
     + "&language=" + language
     + "&provider=" + provider
     + "&keyword=" + keyword
     + "&sort=" + sort
     + "&offset=" + offSet;

    url = encodeURI(url);

    $("#spinny").show();
    $.ajax({
        url: url,
        success: function (data) {
            $("#goone-browser-results").append(data);
            $("#spinny").hide();
            if (totalHits <= 20 || offSet >= totalHits-20){
            $("#load-more-div").hide();
            $("#end-of-results").show();
            } else {
            $("#load-more-div").show();
            $("#end-of-results").hide();
             }
            $("#latest-go1-result h2").html($(".go1-result").last().html());

            if(ptype+'' != $("#type").val()+'' || tag+'' != $("#tag").val()+'' || language+'' != $("#language").val()+'' || provider+'' != $("#provider").val()+'') {
                changeFilter();
            }
        }
    });

}
$(document).ready(function() {
        loadResults($("#type").val(),$("#tag").val(),$("#language").val(),$("#provider").val(),$("#keyword").val(),$("#sort").val(),offSet);

});

$("#load-more").click(function() {
    offSet = offSet + 20;
    loadResults($("#type").val(),$("#tag").val(),$("#language").val(),$("#provider").val(),$("#keyword").val(),$("#sort").val(),offSet);
})
$('#keyword').keypress(function (e) {
  if (e.which == 13) {
    $('#keyword').submit();
    changeFilter();    //<---- Add this line
  }
});

</script>
